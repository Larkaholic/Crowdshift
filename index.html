<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Crowdshift</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
            rel="stylesheet"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui"] },
                        colors: {
                            brand: {
                                50: "#ECFDF5",
                                100: "#D1FAE5",
                                200: "#A7F3D0",
                                300: "#6EE7B7",
                                400: "#34D399",
                                500: "#10B981",
                                600: "#059669",
                                700: "#047857",
                                800: "#065F46",
                                900: "#064E3B",
                            },
                        },
                        boxShadow: {
                            card: "0 1px 2px rgba(16,24,40,.06), 0 1px 3px rgba(16,24,40,.1)",
                        },
                    },
                },
            };
        </script>
        <style>
            html, body { height: 100%; overflow-x: hidden; }
            body { background: #f7faf9; }
        </style>
    </head>
    <body class="min-h-full text-slate-800 overflow-x-hidden">
        <div class="mx-auto w-full max-w-md lg:max-w-7xl p-3">
            <!-- Top Nav -->
            <header class="sticky top-0 z-10 mb-3 rounded-2xl bg-white/80 p-3 backdrop-blur supports-[backdrop-filter]:bg-white/60 shadow-card">
                <div class="flex items-center gap-3">
                    <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-brand-100 text-brand-700">
                        <!-- Logo -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
                            <path d="M12 2a10 10 0 100 20 10 10 0 000-20Zm1 5a1 1 0 10-2 0v5a1 1 0 00.293.707l3 3a1 1 0 101.414-1.414L13 11.586V7Z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <div class="text-xs text-slate-500">Baguio Smart Card</div>
                        <div class="text-base font-semibold">Welcome to Baguio</div>
                    </div>
                    <button id="open-profile-btn" class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-medium text-slate-700 shadow-card hover:bg-slate-50">
                        <span>Profile</span>
                    </button>
                </div>
            </header>

            <!-- Desktop grid wrapper -->
            <main class="grid gap-4 lg:grid-cols-12">

                <!-- City Status -->
                <section class="mb-4 rounded-2xl bg-white p-3 shadow-card w-full md:w-full lg:col-span-12">
                    <div class="mb-3 flex items-center justify-between">
                        <div>
                            <div class="text-xs text-slate-500">City Status</div>
                            <div class="text-[10px] text-slate-400">Real-time congestion overview</div>
                        </div>
                        <button class="text-[10px] font-medium text-brand-700 hover:underline">Normal Flow</button>
                    </div>
                    <div class="grid grid-cols-1 gap-2 md:grid-cols-3">
                        <div class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
                            <div class="flex items-center gap-2">
                                <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-brand-100 text-brand-700">A</span>
                                <div>
                                    <div class="text-xs font-medium">Active Tourists</div>
                                    <div class="text-[10px] text-slate-500">Live city count</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div id="active-tourists-count" class="text-lg font-bold">—</div>
                                <div class="text-[10px] text-emerald-600">+ 5% today</div>
                            </div>
                        </div>
                            <div class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
                                <div class="flex items-center gap-2">
                                    <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-amber-100 text-amber-700">H</span>
                                    <div>
                                        <div class="text-xs font-medium">Hotspots Active</div>
                                        <div class="text-[10px] text-slate-500">Now</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div id="hotspots-active-count" class="text-lg font-bold">—/—</div>
                                    <div class="text-[10px] text-amber-600">Peak nearby</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
                                <div class="flex items-center gap-2">
                                    <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-sky-100 text-sky-700">T</span>
                                    <div>
                                        <div class="text-xs font-medium">Peak Hours</div>
                                        <div class="text-[10px] text-slate-500">Next peak</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold">2-5 PM</div>
                                    <div class="text-[10px] text-sky-600">Today</div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center justify-between">
                            <button id="city-refresh" class="rounded-xl border border-slate-200 bg-white px-3 py-2 text-center text-xs font-semibold text-slate-700 shadow-card hover:bg-slate-50">Refresh</button>
                            <button class="rounded-xl bg-brand-600 px-3 py-2 text-center text-xs font-semibold text-white hover:bg-brand-700">View Detailed Analytics</button>
                        </div>
                </section>

                <!-- Smart Card Options -->
                <section id="smart-card-options" class="mb-4 rounded-2xl bg-white p-3 shadow-card lg:col-span-8 w-[80%] md:w-full">
                    <div class="mb-2 flex items-center justify-between">
                        <div class="text-xs font-semibold">Smart Card Options</div>
                        <button class="text-[10px] text-brand-700 hover:underline">Compare All</button>
                    </div>
                    <div class="space-y-2 md:space-y-0 md:grid md:grid-cols-3 md:gap-3">
                        <!-- Tourist Card -->
                        <div class="flex items-start justify-between rounded-xl border border-slate-100 bg-slate-50 p-3">
                            <div class="flex items-start gap-2">
                                <span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-md bg-indigo-100 text-indigo-700">ID</span>
                                <div>
                                    <div class="text-xs font-semibold">Tourist Card</div>
                                    <ul class="mt-1 list-disc pl-4 text-[10px] text-slate-600">
                                        <li>Shuttle access</li>
                                        <li>Attraction discounts</li>
                                        <li>Cashless payments</li>
                                    </ul>
                                    <div class="mt-2 text-xs font-bold">₱500</div>
                                </div>
                            </div>
                            <button class="h-8 rounded-lg bg-brand-600 px-3 text-[10px] font-semibold text-white hover:bg-brand-700">Get Card</button>
                        </div>
                        <!-- Commuter Card -->
                        <div class="flex items-start justify-between rounded-xl border border-slate-100 bg-slate-50 p-3">
                            <div class="flex items-start gap-2">
                                <span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-md bg-amber-100 text-amber-700">C</span>
                                <div>
                                    <div class="text-xs font-semibold">Commuter Card</div>
                                    <ul class="mt-1 list-disc pl-4 text-[10px] text-slate-600">
                                        <li>Public transit rewards</li>
                                        <li>Transfer priority</li>
                                        <li>Tap-to-pay</li>
                                    </ul>
                                    <div class="mt-2 text-xs font-bold">₱300</div>
                                </div>
                            </div>
                            <button class="h-8 rounded-lg bg-brand-600 px-3 text-[10px] font-semibold text-white hover:bg-brand-700">Get Card</button>
                        </div>
                        <!-- All Access Card -->
                        <div class="flex items-start justify-between rounded-xl border border-slate-100 bg-slate-50 p-3">
                            <div class="flex items-start gap-2">
                                <span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-md bg-pink-100 text-pink-700">AA</span>
                                <div>
                                    <div class="text-xs font-semibold">All Access Card</div>
                                    <ul class="mt-1 list-disc pl-4 text-[10px] text-slate-600">
                                        <li>VIP access</li>
                                        <li>Exclusive perks</li>
                                        <li>City-wide transit</li>
                                    </ul>
                                    <div class="mt-2 text-xs font-bold">₱1,200</div>
                                </div>
                            </div>
                            <button class="h-8 rounded-lg bg-brand-600 px-3 text-[10px] font-semibold text-white hover:bg-brand-700">Get Card</button>
                        </div>
                    </div>
                </section>

            

            <!-- Smart Recommendations (categorized) -->
            <section id="smart-recommendations" class="mb-4 rounded-2xl bg-white p-3 shadow-card lg:col-span-8 w-[80%] md:w-full">
                <div class="mb-2 flex items-center justify-between">
                    <div>
                        <div class="text-xs font-semibold">Smart Recommendations</div>
                        <div class="text-[10px] text-slate-500">Nearby essentials by category</div>
                    </div>
                    <div id="cat-tabs" class="flex items-center gap-2 text-[10px]"></div>
                </div>

                <div id="reco-grid" class="space-y-2 md:space-y-0 md:grid md:grid-cols-2 md:gap-2 lg:grid-cols-3">
                    <!-- cards injected by places.js -->
                </div>
                <div class="mt-3 flex items-center justify-between text-[10px] text-slate-400">
                    <span id="reco-meta">Data updated moments ago</span>
                    <button id="reco-refresh" class="text-brand-700 hover:underline">Refresh</button>
                </div>

                <!-- Curated tourist spot suggestions (merged from old section) -->
                <div class="mt-4 border-t border-slate-100 pt-3">
                    <div class="mb-2 flex items-center justify-between">
                        <div>
                            <div class="text-xs font-semibold">Curated Spots</div>
                            <div class="text-[10px] text-slate-500">Perfect time & nearest transit</div>
                        </div>
                        <button class="text-[10px] text-brand-700 hover:underline">Customize</button>
                    </div>
                    <div class="space-y-3">
                        <div class="rounded-2xl border border-slate-100 bg-slate-50 p-3">
                            <div class="mb-2 flex items-start justify-between">
                                <div>
                                    <div class="text-xs font-semibold">Botanical Garden</div>
                                    <div class="mt-0.5 inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-600">
                                        <span class="h-1.5 w-1.5 rounded-full bg-emerald-500"></span> Best Now
                                    </div>
                                </div>
                                <span class="text-[10px] text-slate-400">0.9 km</span>
                            </div>
                            <ul class="mb-2 list-disc pl-4 text-[10px] text-slate-600">
                                <li>Less crowding</li>
                                <li>Shaded walking paths</li>
                                <li>Parking available</li>
                            </ul>
                            <div class="flex items-center justify-between">
                                <div class="text-[10px] text-slate-500">Card benefits: 10% off, Shuttle R2</div>
                                <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700 js-visit-now" data-dest="Botanical Garden" data-lat="16.4147" data-lng="120.6177">Visit Now</button>
                            </div>
                        </div>

                        <div class="rounded-2xl border border-slate-100 bg-slate-50 p-3">
                            <div class="mb-2 flex items-start justify-between">
                                <div>
                                    <div class="text-xs font-semibold">Camp John Hay</div>
                                    <div class="mt-0.5 inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-medium text-amber-600">
                                        <span class="h-1.5 w-1.5 rounded-full bg-amber-500"></span> Good Soon
                                    </div>
                                </div>
                                <span class="text-[10px] text-slate-400">3.2 km</span>
                            </div>
                            <ul class="mb-2 list-disc pl-4 text-[10px] text-slate-600">
                                <li>Pine breeze</li>
                                <li>Bike & nature trail</li>
                                <li>Cafés nearby</li>
                            </ul>
                            <div class="flex items-center justify-between">
                                <div class="text-[10px] text-slate-500">Card benefits: free hour bike</div>
                                <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700 js-visit-now" data-dest="Camp John Hay" data-lat="16.4010" data-lng="120.6138">Visit Now</button>
                            </div>
                        </div>

                        <div class="rounded-2xl border border-slate-100 bg-slate-50 p-3">
                            <div class="mb-2 flex items-start justify-between">
                                <div>
                                    <div class="text-xs font-semibold">Wright Park</div>
                                    <div class="mt-0.5 inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-600">
                                        <span class="h-1.5 w-1.5 rounded-full bg-emerald-500"></span> Best Now
                                    </div>
                                </div>
                                <span class="text-[10px] text-slate-400">4.0 km</span>
                            </div>
                            <ul class="mb-2 list-disc pl-4 text-[10px] text-slate-600">
                                <li>Horseback riding</li>
                                <li>Family friendly</li>
                                <li>Open shade</li>
                            </ul>
                            <div class="flex items-center justify-between">
                                <div class="text-[10px] text-slate-500">Card benefits: 5% off rentals</div>
                                <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700 js-visit-now" data-dest="Wright Park" data-lat="16.4140" data-lng="120.6229">Visit Now</button>
                            </div>
                        </div>

                        <div class="rounded-2xl border border-slate-100 bg-slate-50 p-3">
                            <div class="mb-2 flex items-start justify-between">
                                <div>
                                    <div class="text-xs font-semibold">Mines View Park</div>
                                    <div class="mt-0.5 inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-medium text-amber-600">
                                        <span class="h-1.5 w-1.5 rounded-full bg-amber-500"></span> Good Soon
                                    </div>
                                </div>
                                <span class="text-[10px] text-slate-400">4.8 km</span>
                            </div>
                            <ul class="mb-2 list-disc pl-4 text-[10px] text-slate-600">
                                <li>Great viewpoint</li>
                                <li>Souvenir stalls</li>
                                <li>Snacks nearby</li>
                            </ul>
                            <div class="flex items-center justify-between">
                                <div class="text-[10px] text-slate-500">Card benefits: 10% off food</div>
                                <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700 js-visit-now" data-dest="Mines View Park" data-lat="16.4205" data-lng="120.6335">Visit Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            

            <!-- Route Map Panel -->
            <section id="route-map-panel" class="hidden lg:col-span-8 w-[80%] md:w-full">
                <div class="rounded-2xl bg-white p-3 shadow-card">
                    <div class="mb-2 flex items-center justify-between">
                        <div>
                            <div id="route-dest-title" class="text-xs font-semibold">Routes</div>
                            <div class="text-[10px] text-slate-500">Showing fastest and shortest paths</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="use-geoloc-btn" class="hidden md:inline-flex rounded-lg border border-slate-200 px-2.5 py-1.5 text-[10px] text-slate-700 hover:bg-slate-50">Use My Location</button>
                            <button id="close-map-btn" class="rounded-lg border border-slate-200 px-2.5 py-1.5 text-[10px] text-slate-700 hover:bg-slate-50">Close</button>
                        </div>
                    </div>
                    <!-- Mode switcher -->
                    <div class="mb-3 flex flex-wrap items-center gap-2">
                        <div class="text-[10px] text-slate-500">Mode:</div>
                        <div id="mode-switch" class="inline-flex rounded-lg border border-slate-200 p-1">
                            <button data-mode="private" class="mode-btn rounded-md px-2 py-1 text-[10px] font-medium text-slate-700 hover:bg-slate-50 bg-slate-100">Private</button>
                            <button data-mode="taxi" class="mode-btn rounded-md px-2 py-1 text-[10px] font-medium text-slate-700 hover:bg-slate-50">Taxi</button>
                            <button data-mode="jeepney" class="mode-btn rounded-md px-2 py-1 text-[10px] font-medium text-slate-700 hover:bg-slate-50">Jeepney</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 gap-3 md:grid-cols-4">
                        <div class="md:col-span-3">
                            <div id="route-map" class="h-[360px] w-full rounded-xl border border-slate-100"></div>
                        </div>
                        <div class="md:col-span-1">
                            <div class="rounded-xl border border-slate-100 p-2 text-[12px]">
                                <div class="mb-2 font-semibold">Route Options</div>
                                <ul id="route-list" class="space-y-2"></ul>
                                <!-- POI list for Taxi/Jeepney -->
                                <div id="poi-section" class="mt-3 hidden">
                                    <div id="poi-title" class="mb-1 text-[11px] font-semibold text-slate-700">Nearby</div>
                                    <ul id="poi-list" class="space-y-2"></ul>
                                </div>
                                <div class="mt-2 text-[10px] text-slate-500">Legend: <span class="inline-block h-2 w-3 rounded-sm bg-emerald-500 align-middle"></span> Shortest · <span class="inline-block h-2 w-3 rounded-sm bg-sky-500 align-middle"></span> Fastest · <span class="inline-block h-2 w-3 rounded-sm bg-slate-300 align-middle"></span> Alternate</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Active Balance (actual content) -->
            <section id="active-balance" class="mb-4 rounded-2xl bg-white p-3 shadow-card lg:col-span-4 lg:row-start-2 lg:col-start-9 w-[80%] md:w-full">
                <div class="mb-3 flex items-start justify-between">
                    <div>
                        <div class="text-xs font-semibold">Active Balance</div>
                        <div id="active-card-label" class="text-[10px] text-slate-500">Baguio Smart Card (R-4H52)</div>
                    </div>
                    <button class="text-[10px] text-brand-700 hover:underline">View All</button>
                </div>
                <div class="mb-3 flex items-end justify-between">
                    <div>
                        <div id="balance-amount" class="text-2xl font-extrabold">₱487.50</div>
                        <div class="text-[10px] text-emerald-600">+ ₱50 today</div>
                    </div>
                    <button class="js-topup-open rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Top Up</button>
                </div>
                <div class="space-y-2">
                    <!-- Activity rows -->
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-2 text-[12px]">
                        <div class="flex items-center gap-2">
                            <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-slate-100">🚌</span>
                            <div class="text-slate-700">Shuttle Ride - Session Road</div>
                        </div>
                        <div class="font-medium text-slate-800">₱15</div>
                    </div>
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-2 text-[12px]">
                        <div class="flex items-center gap-2">
                            <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-slate-100">🅿️</span>
                            <div class="text-slate-700">Burnham Park Parking</div>
                        </div>
                        <div class="font-medium text-slate-800">₱25</div>
                    </div>
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-2 text-[12px]">
                        <div class="flex items-center gap-2">
                            <span class="inline-flex h-6 w-6 items-center justify-center rounded-md bg-slate-100">🎟️</span>
                            <div class="text-slate-700">Card Discount Applied</div>
                        </div>
                        <div class="font-medium text-emerald-600">-₱50</div>
                    </div>
                </div>
            </section>

            <!-- Parking Availability -->
            <section id="parking-availability" class="mb-4 rounded-2xl bg-white p-3 shadow-card lg:col-span-4 lg:row-start-3 lg:col-start-9 w-[80%] md:w-full">
                <div class="mb-2 flex items-center justify-between">
                    <div class="text-xs font-semibold">Parking Availability</div>
                    <button class="text-[10px] text-brand-700 hover:underline">View Map</button>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-3">
                        <div class="text-xs">
                            <div class="font-semibold">Burnham Park Parking</div>
                            <div class="text-[10px] text-slate-500">15/100 spaces · 0.9 km</div>
                        </div>
                        <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Reserve</button>
                    </div>
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-3">
                        <div class="text-xs">
                            <div class="font-semibold">Session Road Parking</div>
                            <div class="text-[10px] text-slate-500">3/40 spaces · 0.4 km</div>
                        </div>
                        <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Reserve</button>
                    </div>
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-3">
                        <div class="text-xs">
                            <div class="font-semibold">SM City Baguio Parking</div>
                            <div class="text-[10px] text-slate-500">12/500 spaces · 1.2 km</div>
                        </div>
                        <button class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Reserve</button>
                    </div>
                </div>
            </section>

            <!-- Shuttle Routes -->
            <section id="shuttle-routes" class="mb-4 rounded-2xl bg-white p-3 shadow-card lg:col-span-4 lg:row-start-4 lg:col-start-9 w-[80%] md:w-full">
                <div class="mb-2 flex items-center justify-between">
                    <div class="text-xs font-semibold">Shuttle Routes</div>
                    <button class="text-[10px] text-brand-700 hover:underline">View Schedules</button>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-3">
                        <div class="text-xs">
                            <div class="font-semibold">City Circle Route</div>
                            <div class="text-[10px] text-slate-500">Every 10 mins</div>
                        </div>
                        <button class="js-shuttle-book rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700" data-route-id="city-circle">Book Now</button>
                    </div>
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-3">
                        <div class="text-xs">
                            <div class="font-semibold">Tourist Spots Shuttle</div>
                            <div class="text-[10px] text-slate-500">Every 20 mins</div>
                        </div>
                        <button class="js-shuttle-book rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700" data-route-id="tourist-spots">Book Now</button>
                    </div>
                    <div class="flex items-center justify-between rounded-xl border border-slate-100 p-3">
                        <div class="text-xs">
                            <div class="font-semibold">Shopping District Loop</div>
                            <div class="text-[10px] text-slate-500">Every 12 mins</div>
                        </div>
                        <button class="js-shuttle-book rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700" data-route-id="shopping-district">Book Now</button>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="mb-20 rounded-2xl bg-white p-3 shadow-card lg:col-span-4 lg:row-start-5 lg:col-start-9 w-[80%] md:w-full">
                <div class="mb-2 flex items-center justify-between">
                    <div class="text-xs font-semibold">Quick Actions</div>
                    <button class="text-[10px] text-brand-700 hover:underline">Customize</button>
                </div>

                <div class="grid grid-cols-4 gap-2 text-center text-[10px]">
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="topup">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-brand-50 text-brand-700">➕</span>
                        <span>Top-up</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="buy-card">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-50 text-indigo-700">💳</span>
                        <span>Buy Card</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="bus-routes">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-purple-50 text-purple-700">🚌</span>
                        <span>Bus Routes</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="parking">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-amber-50 text-amber-700">🅿️</span>
                        <span>Parking</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="book-tour">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-pink-50 text-pink-700">📸</span>
                        <span>Book Tour</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="map">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-sky-50 text-sky-700">🗺️</span>
                        <span>Map</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="settings">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-orange-50 text-orange-700">⚙️</span>
                        <span>Settings</span>
                    </button>
                    <button class="js-qa flex flex-col items-center gap-1 rounded-xl border border-slate-100 p-3 hover:bg-slate-50" data-action="help">
                        <span class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-slate-50 text-slate-700">ℹ️</span>
                        <span>Help</span>
                    </button>
                </div>

                <div class="mt-4">
                    <button class="js-topup-open w-full rounded-xl bg-brand-600 px-3 py-2 text-xs font-semibold text-white hover:bg-brand-700" data-amount="500">Top-up ₱500</button>
                </div>
            </section>

            </main>
        </div>
        
        <!-- Shuttle Booking Modal -->
        <div id="shuttle-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 p-4">
            <div class="w-full max-w-md rounded-2xl bg-white p-4 shadow-card">
                <div class="mb-2 flex items-start justify-between">
                    <div>
                        <div id="shuttle-title" class="text-xs font-semibold">Book Shuttle</div>
                        <div id="shuttle-subtitle" class="text-[10px] text-slate-500">Select schedule and seats</div>
                    </div>
                    <button id="shuttle-close" class="rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] text-slate-700 hover:bg-slate-50">Close</button>
                </div>
                <div class="space-y-3 text-[12px]">
                    <div>
                        <label class="mb-1 block text-[10px] text-slate-600">Pick-up Terminal</label>
                        <select id="shuttle-terminal" class="w-full rounded-lg border border-slate-200 p-2 text-[12px]">
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="mb-1 block text-[10px] text-slate-600">Date</label>
                            <input id="shuttle-date" type="date" class="w-full rounded-lg border border-slate-200 p-2" />
                        </div>
                        <div>
                            <label class="mb-1 block text-[10px] text-slate-600">Time</label>
                            <select id="shuttle-time" class="w-full rounded-lg border border-slate-200 p-2 text-[12px]"></select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="mb-1 block text-[10px] text-slate-600">Seats</label>
                            <input id="shuttle-seats" type="number" min="1" value="1" class="w-full rounded-lg border border-slate-200 p-2" />
                        </div>
                        <div>
                            <label class="mb-1 block text-[10px] text-slate-600">Payment</label>
                            <select id="shuttle-payment" class="w-full rounded-lg border border-slate-200 p-2 text-[12px]">
                                <option value="card">Smart Card</option>
                                <option value="cash">Cash</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="mb-1 block text-[10px] text-slate-600">Notes (optional)</label>
                        <textarea id="shuttle-notes" rows="2" class="w-full resize-none rounded-lg border border-slate-200 p-2"></textarea>
                    </div>
                    <div id="shuttle-fare" class="rounded-xl bg-slate-50 p-2 text-[11px]"></div>
                </div>
                <div class="mt-4 flex items-center justify-between">
                    <div id="shuttle-feedback" class="text-[10px] text-slate-500"></div>
                    <button id="shuttle-confirm" class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Confirm Booking</button>
                </div>
            </div>
        </div>

        <!-- Top Up Modal (multi-step) -->
        <div id="topup-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 p-4">
            <div class="w-full max-w-md rounded-2xl bg-white p-4 shadow-card">
                <div class="mb-2 flex items-start justify-between">
                    <div>
                        <div class="text-xs font-semibold">Top Up Smart Card</div>
                        <div id="topup-subtitle" class="text-[10px] text-slate-500">Add balance securely</div>
                    </div>
                    <button id="topup-close" class="rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] text-slate-700 hover:bg-slate-50">Close</button>
                </div>

                <!-- Step 1: Amount -->
                <div class="topup-step" data-step="1">
                    <div class="mb-2 text-[11px] font-semibold">Choose Amount</div>
                    <div class="mb-3 grid grid-cols-4 gap-2 text-[12px]">
                        <button class="tp-amt rounded-lg border border-slate-200 p-2 hover:bg-slate-50" data-amt="100">₱100</button>
                        <button class="tp-amt rounded-lg border border-slate-200 p-2 hover:bg-slate-50" data-amt="300">₱300</button>
                        <button class="tp-amt rounded-lg border border-slate-200 p-2 hover:bg-slate-50" data-amt="500">₱500</button>
                        <button class="tp-amt rounded-lg border border-slate-200 p-2 hover:bg-slate-50" data-amt="1000">₱1,000</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="mb-1 block text-[10px] text-slate-600">Custom Amount</label>
                            <input id="tp-amount" type="number" min="50" step="50" class="w-full rounded-lg border border-slate-200 p-2" placeholder="₱" />
                        </div>
                        <div>
                            <label class="mb-1 block text-[10px] text-slate-600">Receipt Email (optional)</label>
                            <input id="tp-email" type="email" class="w-full rounded-lg border border-slate-200 p-2" placeholder="you@email.com" />
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-end">
                        <button id="tp-next-1" class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Continue</button>
                    </div>
                </div>

                <!-- Step 2: Method -->
                <div class="topup-step hidden" data-step="2">
                    <div class="mb-2 text-[11px] font-semibold">Payment Method</div>
                    <div class="space-y-2 text-[12px]">
                        <label class="flex items-center gap-2 rounded-lg border border-slate-200 p-2 hover:bg-slate-50">
                            <input type="radio" name="tp-method" value="card" checked />
                            <span>Credit / Debit Card</span>
                        </label>
                        <label class="flex items-center gap-2 rounded-lg border border-slate-200 p-2 hover:bg-slate-50">
                            <input type="radio" name="tp-method" value="ewallet" />
                            <span>E‑Wallet (GCash / Maya)</span>
                        </label>
                        <label class="flex items-center gap-2 rounded-lg border border-slate-200 p-2 hover:bg-slate-50">
                            <input type="radio" name="tp-method" value="kiosk" />
                            <span>Cash at Kiosk</span>
                        </label>
                        <label class="flex items-center gap-2 rounded-lg border border-slate-200 p-2 hover:bg-slate-50">
                            <input id="tp-autoreload" type="checkbox" />
                            <span>Enable Auto‑Reload when balance < ₱100</span>
                        </label>
                    </div>
                    <div class="mt-3 flex items-center justify-between text-[10px] text-slate-500">
                        <button class="tp-back rounded-lg border border-slate-200 px-2.5 py-1 hover:bg-slate-50">Back</button>
                        <button id="tp-next-2" class="rounded-lg bg-brand-600 px-3 py-1.5 font-semibold text-white hover:bg-brand-700">Continue</button>
                    </div>
                </div>

                <!-- Step 3: Details -->
                <div class="topup-step hidden" data-step="3">
                    <div id="tp-card-fields" class="space-y-2 text-[12px]">
                        <div class="text-[11px] font-semibold">Card Details</div>
                        <input id="tp-card-number" class="w-full rounded-lg border border-slate-200 p-2" placeholder="Card number" />
                        <div class="grid grid-cols-2 gap-2">
                            <input id="tp-card-exp" class="w-full rounded-lg border border-slate-200 p-2" placeholder="MM/YY" />
                            <input id="tp-card-cvv" class="w-full rounded-lg border border-slate-200 p-2" placeholder="CVV" />
                        </div>
                        <input id="tp-card-name" class="w-full rounded-lg border border-slate-200 p-2" placeholder="Name on card" />
                        <label class="flex items-center gap-2"><input id="tp-save-card" type="checkbox" /> <span>Save card for faster top‑ups</span></label>
                    </div>
                    <div id="tp-ewallet-fields" class="hidden space-y-2 text-[12px]">
                        <div class="text-[11px] font-semibold">E‑Wallet</div>
                        <div class="rounded-lg border border-dashed border-slate-300 p-4 text-center text-[11px] text-slate-500">Scan QR in your wallet app to pay<br/><span class="text-slate-400">(demo placeholder)</span></div>
                    </div>
                    <div id="tp-kiosk-fields" class="hidden space-y-2 text-[12px]">
                        <div class="text-[11px] font-semibold">Cash at Kiosk</div>
                        <div class="rounded-lg border border-dashed border-slate-300 p-4 text-center text-[11px] text-slate-500">Show this code at any kiosk<br/><span class="text-slate-400">(demo barcode placeholder)</span></div>
                    </div>
                    <div class="mt-3 flex items-center justify-between text-[10px] text-slate-500">
                        <button class="tp-back rounded-lg border border-slate-200 px-2.5 py-1 hover:bg-slate-50">Back</button>
                        <button id="tp-next-3" class="rounded-lg bg-brand-600 px-3 py-1.5 font-semibold text-white hover:bg-brand-700">Review</button>
                    </div>
                </div>

                <!-- Step 4: Review -->
                <div class="topup-step hidden" data-step="4">
                    <div class="space-y-2 text-[12px]">
                        <div class="text-[11px] font-semibold">Review</div>
                        <div id="tp-review" class="rounded-xl bg-slate-50 p-2"></div>
                        <div class="text-[10px] text-slate-500">Fees: Card/E‑Wallet 1.5% · Kiosk 0%</div>
                    </div>
                    <div class="mt-3 flex items-center justify-between">
                        <button class="tp-back rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] hover:bg-slate-50">Back</button>
                        <button id="tp-confirm" class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Confirm Top Up</button>
                    </div>
                    <div id="tp-feedback" class="mt-2 text-[10px] text-slate-500"></div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 p-4">
            <div class="w-full max-w-md rounded-2xl bg-white p-4 shadow-card">
                <div class="mb-2 flex items-center justify-between">
                    <div class="text-xs font-semibold">Settings</div>
                    <button class="js-close-settings rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] text-slate-700 hover:bg-slate-50">Close</button>
                </div>
                <div class="space-y-3 text-[12px]">
                    <label class="flex items-center justify-between rounded-xl border border-slate-200 p-2">
                        <span>Dark Mode</span>
                        <input id="opt-dark" type="checkbox" />
                    </label>
                    <label class="flex items-center justify-between rounded-xl border border-slate-200 p-2">
                        <span>Auto‑Reload under ₱100</span>
                        <input id="opt-autoreload" type="checkbox" />
                    </label>
                </div>
                <div class="mt-3 text-right">
                    <button id="settings-save" class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Save</button>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="help-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 p-4">
            <div class="w-full max-w-md rounded-2xl bg-white p-4 shadow-card">
                <div class="mb-2 flex items-center justify-between">
                    <div class="text-xs font-semibold">Help</div>
                    <button class="js-close-help rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] text-slate-700 hover:bg-slate-50">Close</button>
                </div>
                <div class="space-y-2 text-[12px] text-slate-700">
                    <p>• Use Smart Recommendations to find the best time to visit spots.</p>
                    <p>• Switch modes in the Routes panel to use Taxi or Jeepney.</p>
                    <p>• Top Up via Quick Actions to add balance to your card.</p>
                </div>
            </div>
        </div>

        <!-- Profile Modal -->
        <div id="profile-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/30 p-4">
            <div class="w-full max-w-lg rounded-2xl bg-white p-4 shadow-card">
                <div class="mb-2 flex items-center justify-between">
                    <div class="text-xs font-semibold">Profile</div>
                    <button id="profile-close" class="rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] text-slate-700 hover:bg-slate-50">Close</button>
                </div>
                <div class="grid grid-cols-1 gap-3 md:grid-cols-2 text-[12px]">
                    <div class="md:col-span-2">
                        <div class="text-[11px] font-semibold">Account</div>
                        <div class="mt-2 grid grid-cols-2 gap-2">
                            <input id="prof-name" class="rounded-lg border border-slate-200 p-2" placeholder="Full name" />
                            <input id="prof-email" type="email" class="rounded-lg border border-slate-200 p-2" placeholder="Email" />
                        </div>
                        <div class="mt-2 text-right">
                            <button id="prof-save" class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Save</button>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <div class="mb-1 flex items-center justify-between">
                            <div class="text-[11px] font-semibold">Linked Cards</div>
                            <div class="flex items-center gap-2">
                                <button id="card-register-btn" class="rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] hover:bg-slate-50">Register Card</button>
                            </div>
                        </div>
                        <ul id="cards-list" class="space-y-2"></ul>
                        <div id="cards-empty" class="text-[10px] text-slate-500">No cards linked yet.</div>
                    </div>
                    <div id="card-register-panel" class="md:col-span-2 hidden">
                        <div class="rounded-xl border border-slate-200 p-3">
                            <div class="mb-2 text-[11px] font-semibold">Register Card</div>
                            <div class="grid grid-cols-1 gap-2 md:grid-cols-2">
                                <div>
                                    <label class="mb-1 block text-[10px] text-slate-600">Enter Card ID</label>
                                    <div class="flex gap-2">
                                        <input id="card-id-input" class="flex-1 rounded-lg border border-slate-200 p-2" placeholder="e.g. R-4H52" />
                                        <button id="card-link-btn" class="rounded-lg bg-brand-600 px-3 py-1.5 text-[10px] font-semibold text-white hover:bg-brand-700">Link</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="mb-1 block text-[10px] text-slate-600">Scan QR</label>
                                    <div class="space-y-2">
                                        <div class="rounded-lg border border-slate-200 p-2">
                                            <video id="qr-video" class="h-40 w-full rounded-md bg-black object-cover" playsinline></video>
                                            <canvas id="qr-canvas" class="hidden"></canvas>
                                        </div>
                                        <div class="flex gap-2">
                                            <button id="qr-start" class="rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] hover:bg-slate-50">Start Scan</button>
                                            <button id="qr-stop" class="rounded-lg border border-slate-200 px-2.5 py-1 text-[10px] hover:bg-slate-50">Stop</button>
                                        </div>
                                        <div id="qr-feedback" class="text-[10px] text-slate-500"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaflet and Routing assets -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        <script src="https://unpkg.com/@tmcw/togeojson"></script>
        <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>

        <!-- App scripts -->
    <script src="/js/map.js" defer></script>
    <script src="/js/places.js" defer></script>
    <script src="/js/recommendations.js" defer></script>
        <script src="/js/shuttle.js" defer></script>
    <script src="/js/quickActions.js" defer></script>
    <script src="/js/topup.js" defer></script>
    <!-- jsQR for QR scanning -->
    <script src="https://unpkg.com/jsqr" defer></script>
    <script src="/js/profile.js" defer></script>
    <script src="/js/analytics.js" defer></script>
        <script src="/js/main.js" defer></script>
    </body>
    </html>